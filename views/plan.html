<section id="view-plan" class="hidden animate-fade-in space-y-8">
    <!-- Top Row: Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Readiness -->
        <div class="glass-panel p-6 rounded-xl relative overflow-hidden">

            <div class="flex justify-between items-start z-10 relative">
                <div>
                    <h3 class="text-lg font-bold text-slate-800">Current Readiness</h3>
                    <p class="text-xs text-slate-500">For your <span id="disp-family">Family</span></p>
                </div>
                <div class="bg-slate-100 p-2 rounded-lg text-slate-600"><i class="fa-solid fa-hourglass-start text-xl"></i></div>
            </div>
            <div class="mt-4 flex items-end">
                <span class="text-4xl font-bold text-interhyp-blue" id="out-readiness">0%</span>
                <span class="text-sm text-slate-500 mb-1 ml-2">Score</span>
            </div>
            <div class="w-full bg-slate-200 h-2 rounded-full mt-2 overflow-hidden">
                <div id="bar-readiness" class="h-full bg-interhyp-blue transition-all duration-1000" style="width: 0%"></div>
            </div>
            <p class="text-xs text-slate-500 mt-2">Current Buying Power: <b>€<span id="txt-power">0</span></b> (adjusted for living costs, including credits).</p>
        </div>

        <!-- Likelihood -->
        <div class="glass-panel p-6 rounded-xl relative overflow-hidden">
            <div class="flex justify-between items-start z-10 relative">
                <div>
                    <h3 class="text-lg font-bold text-interhyp-blue">Success Likelihood</h3>
                    <p class="text-xs text-slate-500">Using <span id="disp-risk-name">Balanced</span> Strategy</p>
                </div>
                <div class="bg-blue-50 p-2 rounded-lg text-interhyp-blue"><i class="fa-solid fa-chart-pie text-xl"></i></div>
            </div>
            <div class="mt-4 flex items-end">
                <span class="text-4xl font-bold text-interhyp-accent" id="out-likelihood">0%</span>
                <span class="text-sm text-slate-500 mb-1 ml-2">Probability</span>
            </div>
            <div class="w-full bg-slate-200 h-2 rounded-full mt-2 overflow-hidden">
                <div id="bar-likelihood" class="h-full bg-interhyp-accent transition-all duration-1000" style="width: 0%"></div>
            </div>
            <p class="text-xs text-slate-500 mt-2">Probability of reaching goal in <span id="txt-year">X</span> years.</p>
        </div>
    </div>

    <!-- Key Figures -->
    <div class="glass-panel p-6 rounded-xl">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
            <!-- Row 1 -->
            <div>
                <p class="text-xs text-slate-500 uppercase tracking-wider">Current Buying Power</p>
                <p class="text-2xl font-bold text-slate-800 mt-1">€<span id="key-buying-power">0</span></p>
            </div>
            <div class="lg:text-center">
                <p class="text-xs text-slate-500 uppercase tracking-wider">Projected Equity</p>
                <p class="text-2xl font-bold text-interhyp-blue mt-1">€<span id="key-projected-equity">0</span></p>
            </div>
            <div class="lg:text-right">
                <p class="text-xs text-slate-500 uppercase tracking-wider">Time to Goal (curr. rate, invested)</p>
                <p class="text-2xl font-bold text-interhyp-accent mt-1"><span id="key-time-invested">0</span> years</p>
            </div>
            <div class="lg:text-center">
                <p class="text-xs text-slate-500 uppercase tracking-wider">Required Savings Rate (Invested)</p>
                <p class="text-2xl font-bold text-green-600 mt-1">€<span id="key-required-invested">0</span>/mo</p>
            </div>

            <!-- Row 2 -->
            <div>
                <p class="text-xs text-slate-500 uppercase tracking-wider">Target Price</p>
                <p class="text-2xl font-bold text-slate-800 mt-1">€<span id="key-target-price">0</span></p>
            </div>
            <div class="lg:text-center">
                <p class="text-xs text-slate-500 uppercase tracking-wider">Required Down Payment</p>
                <p class="text-2xl font-bold text-interhyp-blue mt-1">€<span id="key-down-payment">0</span></p>
            </div>
            <div class="lg:text-right">
                <p class="text-xs text-slate-500 uppercase tracking-wider">Time to Goal (curr. rate, Cash)</p>
                <p class="text-2xl font-bold text-interhyp-accent mt-1"><span id="key-time-cash">0</span> years</p>
            </div>
            <div class="lg:text-center">
                <p class="text-xs text-slate-500 uppercase tracking-wider">Required Savings Rate (Cash)</p>
                <p class="text-2xl font-bold text-amber-600 mt-1">€<span id="key-required-cash">0</span>/mo</p>
            </div>
        </div>
    </div>

    <!-- Middle: Chart & AI Chat (Side by Side on LG) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Chart -->
        <div class="lg:col-span-2 glass-panel p-6 rounded-xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-slate-800">Equity Projection</h3>
                <div class="text-right">
                     <span class="text-xs font-bold text-slate-400 uppercase">Projected Total</span>
                     <div class="text-xl font-bold text-interhyp-blue" id="out-final-equity">€0</div>
                </div>
            </div>
            <div class="h-[350px] w-full">
                <canvas id="projectionChart"></canvas>
            </div>
            <!-- Timeline Slider -->
            <div class="mt-6 space-y-2">
                <div class="flex justify-between items-center">
                    <label for="chart-year-slider" class="text-sm font-semibold text-slate-700">Adjust Timeline</label>
                    <span id="chart-slider-label" class="text-sm font-bold text-interhyp-blue">Projection: Year 0</span>
                </div>
                <input
                    type="range"
                    id="chart-year-slider"
                    min="1"
                    max="30"
                    value="1"
                    class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-interhyp-blue"
                    style="outline: none;"
                >
                <div class="flex justify-between text-xs text-slate-500">
                    <span>Year 1</span>
                    <span>Year 30</span>
                </div>
            </div>
        </div>

        <!-- AI Chat Assistant (RESTORED) -->
        <div class="glass-panel p-0 rounded-xl flex flex-col h-[594px] overflow-hidden border-slate-200 shadow-lg">
            <!-- Header -->
            <div class="bg-interhyp-dark p-4 flex justify-between items-center text-white">
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-interhyp-success rounded-full mr-2 animate-pulse"></div>
                    <span class="font-bold text-sm">AI Assistant</span>
                </div>
                <span class="text-[10px] bg-white/20 px-2 py-0.5 rounded font-bold tracking-wide">GEMINI</span>
            </div>
            
            <!-- Messages Area -->
            <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50">
                <div class="flex items-start chat-bubble">
                    <div class="w-8 h-8 rounded-full bg-interhyp-blue flex items-center justify-center text-white text-xs mr-2 flex-shrink-0">
                        <i class="fa-solid fa-robot"></i></div>
                    <div id="first-ai-text" class="bg-white rounded-2xl rounded-tl-none p-3 text-sm text-slate-700 shadow-sm border border-slate-200">
                        Hi! I see you're <span id="chat-status-text">married with 0 kids</span> and have a <span id="chat-risk-text">Balanced</span> risk profile. Whether you're buying your first home, expanding your portfolio, or planning for future family needs, I’m here to help. What’s your vision for real estate in the next few years?
                    </div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="p-3 bg-white border-t border-slate-200">
                <div class="flex shadow-sm rounded-lg overflow-hidden border border-slate-300 focus-within:ring-2 focus-within:ring-interhyp-blue transition-all">
                    <input type="text" id="chat-input" aria-label="Ask a question" placeholder="Ask a question..." class="flex-1 px-3 py-2 text-sm outline-none">
                    <button onclick="app.sendChat()" class="bg-interhyp-blue text-white px-4 hover:bg-interhyp-dark transition-colors">
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom: CTA -->
    <div class="bg-interhyp-light border border-blue-200 p-6 rounded-xl flex flex-col md:flex-row items-center justify-between">
        <div>
            <h4 class="font-bold text-interhyp-dark text-lg">Ready to see the market?</h4>
            <p class="text-sm text-slate-600">Based on your adjusted buying power of <span class="font-bold" id="cta-power">€0</span>.</p>
        </div>
        <div class="mt-4 md:mt-0 flex items-center space-x-3">
            <button onclick="app.showAffordableHomes()" class="bg-interhyp-blue text-white font-bold px-6 py-3 rounded-lg shadow hover:bg-interhyp-dark transition-colors">
                Show Affordable Homes
            </button>
            <button onclick="app.showDreamHomes()" class="bg-interhyp-blue text-white font-bold px-6 py-3 rounded-lg shadow hover:bg-interhyp-dark transition-colors">
                Show Dream Homes
            </button>
        </div>
    </div>
</section>
